\section{Calibration and initialization}

\subsection{Problematique de la calibration}

	Les systemes embarque comme les smartphones disposent pour la plupart de capteurs servant au systeme ou a l'utilisateur pour se renseigner sur des grandeurs utiles quant a l'appareil lui-meme ou bien a son environnement. Ces capteurs sont donc varies mais on peut notamment distinguer les capteurs constituant une centrale inertielle ou IMU pour Inertial Measurement Unit que sont les accelerometres et les gyroscopes 3 axes. Ces capteurs sont de plus en plus associes avec un magnetometre. Ainsi, ces capteurs peuvent constituer un AHRS pour Attitude and Heading Reference System ayant pour but de reperer l'appareil dans l'espace 3D. L'accelerometre sert ici a mesurer l'acceleration lineaire, le gyroscope la vitesse angulaire et le magnetometre le champ magnetique terrestre local et sert dans la plupart des cas de compas. Dans le cas d'un smartphone, ces capteurs sont low-cost et de type MEMS pour Micro-Electro-Mechanical Systems. Des lors, le signal utile etant faible, l'erreur induite peut-etre du meme ordre de grandeur et donc conduire a des imprecisions importantes, notamment dans le cas des AHRS qui font l'objet d'une fusion de donnees. Il convient donc d'eliminer ou tout du moins de reduire ces erreurs via une calibration initiale de l'ensemble des capteurs utilises.

\subsection{Types et modele d'erreur}

	Tous les types de capteurs presentent des biais, facteurs d'echelle (scale factors), des erreurs d'inter-couplage (misalignements et cross axis sensitivities) et dans une certaine mesure du bruit aleatoire. Des erreurs d'ordre superieur, des erreurs d'inter-couplage d'acceleration angulaire ou encore des erreurs specifiques comme les softs et irons distorsions pour le magnetometre peuvent egalement se produire.
Pour l'ensemble des capteurs, un modele rendant compte des erreurs lors des differentes mesures peut-etre propose :

\begin{equation}
	X_i = MS \cdot \left( X_{i,raw} - \textbf{b} \right) + \textbf{n}_i
\end{equation}


ou $X_i$ est la mesure du capteur comprenant les erreurs, $X_{i, raw}$ la mesure reelle du capteur,  $b$ le biais,  $S$ la matrice rendant compte des scales factor errors, $M$ la matrice des misalignement entre les axes du capteur et $\textbf{n}_i$ le bruit aleatoire avec $i \in \{x,y,z\}$.
Les differents matrices sont alors \\

\begin{center}
$S = \begin{pmatrix}  	s_{xx} & s_{xy} & s_{xz} \\ s_{yx} & s_{yy} & s_{yz} \\s_{zx} & s_{zy} & s_{zz}  \end{pmatrix}$ 	
 et
 $M = \begin{pmatrix}  1 & -\alpha_{yz} & \alpha_{zy} \\  0 & 1 & -\alpha_{zx} \\  0 & 0 & 1 \end{pmatrix} $
\end{center} 

\vspace{0.2cm}

ou $\alpha_{ij}$ avec $i,j \in \{x,y,z\} $ est l'angle de misalignement entre l'axe $i$ du repere du capteur avec celui de la plateforme selon l'axe $j$ de la plateforme. Enfin le biais est represente par un vecteur $\textbf {b} \in \mathbb{R}^3$


\subsection{Methodes adoptees}

Une premiere calibration d'usine est effectuee mais s'avere souvent imprecise ou obsolete du fait de l'usure des capteurs. Des lors, une nouvelle calibration s'avere necessaire.

La calibration des capteurs se fera dans un premier temps independamment les unes des autres et de maniere statique emph{i. e.} a l'initialisation. Il est a noter que nous ne prendrons pas en compte ici l'influence de la temperature puisqu'il est deja traite dans la calibration d'usine.

\subsubsection{Accelerometre}

Freescale propose une methode de calibration lineaire de l'accelerometre 3 axes. Elle repose sur le fait que la somme des amplitudes des composantes normalisees du champ gravitationnel terrestre sur les 3 axes du capteur doit equationetre egale a l'amplitude totale de celui-ci quand le capteur est dans un etat quasi statique. Elle consiste a placer l'appareil dans 8 positions donnees pour chaque axe puis d'utiliser une methode d'optimisation de moindres carres pour determiner les 12 parametres de calibration que sont les scale factors et le biais.

Cette methode ne permet toutefois pas de determiner les misalignements. 

\subsubsection{Gyroscope}

Zhang  propose une methode de calibration du gyroscope\cite{Gyroscope}. Elle repose sur le fait que la somme des mesures selon les 3 axes du gyroscope doit equationetre egale a la vitesse angulaire en entree. 

2 etapes sont alors necessaires a la calibration du gyroscope. La premiere consiste en des rotations horaires et anti-horaires permettant d'eliminer la vitesse angulaire de rotation de la terre et le biais du gyroscope en prenant le carre de la norme de la difference des integrales des mesures dans les 2 sens puis en utilisant une methode de moindre carre. Les scales factors et les angles de misalignements sont ainsi determines. Ensuite, les angles de misalignements et les scales factors sont utilises pour estimer le biais via la difference des carres de l'equation de la somme des vitesses angulaires pour 2 positions differentes.

\subsubsection{Magnetometre}

	Vasconcelos et al. \cite{MLE} proposent un algorithme dit de maximum likelihood estimation (MLE) qui utilise l'estimation issue de "Two-Step" \cite{Two-Step}, $i. e.$ une methode d'estimation de moindre carre suivie d'un filtrage etendu de Kalman (EKF), comme approximation initiale et qui traite le bruit de mesure comme une distribution normale.

	Le probleme de minimisation  la fonction  de vraisemblance (likelihood) qui est quadratique revient alors a determiner les points de l'ellipsoide  qui correspondent au mieux aux mesures du capteur.

	Ce probleme est resolu via la methode du gradient et une methode de Newton descendante pour des espaces euclidiens \cite{Newton} et la regle de Armijo pour la determination de la taille du pas. Le gradient et la matrice hessienne de la fonction de log-likelihood sont eux calcules analytiquement. 

\subsubsection{Calibration on-board}

	Une calibration on-board peut egalement s'averer necessaire du fait d'un besoin de precision accrue ou de l'obsolescence de la calibration d'usine due a l'usure des capteurs.
